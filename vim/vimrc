" Enable UTF8
scriptencoding UTF-8
set encoding=UTF-8

" Theming and colors
set conceallevel=3
if !exists('g:syntax_on')
  syntax enable
endif

" General options
set number                      "Show line numbers
set ruler
set term=screen-256color
set showmatch
set novisualbell                "Disable flash bell
set noerrorbells                "Disable bell
set smartcase
set ignorecase
set incsearch
set nocompatible
set undolevels=1000
set history=1000                "Store lots of :cmdline history
set backspace=indent,eol,start
set wrap
set showcmd                     "Show incomplete cmds down the bottom
set showmode                    "Show current mode down the bottom
set autoread                    "Reload files changed outside vim
set hidden
set shortmess+=F                " Disabled "filename" XXXL, XXXC
set noshowcmd                   " Disable display of last command
set noshowmode                  " Disable -- INSERT --

" Search highlight
set hlsearch
hi Search ctermbg=222

" Vim tabs
"CTRL+N creates a new window
nnoremap <C-n> :tabnew<CR>

" More natural split opening
set splitbelow
set splitright

" Easier split nav
nnoremap <C-J> <C-W><C-J>
nnoremap <C-K> <C-W><C-K>
nnoremap <C-L> <C-W><C-L>
nnoremap <C-H> <C-W><C-H>

" Indent stuff
set autoindent                  "Always set autoindenting on
set copyindent                  "Copy the previous indentation on autoindenting
set expandtab                   "Expand tabs by default (overloadable per file type)
set shiftround                  "Use multiple of shiftwidth when indenting with '<' and '>'
set shiftwidth=2                "Number of spaces to use for autoindenting
set smartindent
set smarttab                    "Insert tabs on the start of a line according to shiftwidth, not tabstop
set softtabstop=2               "When hitting <BS>, pretend like a tab is removed, even if spaces
set tabstop=2                   "Tabs are n spaces

" Enable folding
set foldmethod=indent
set foldnestmax=20
set nofoldenable
set foldlevel=99

" Enable folding with the spacebar
nnoremap <space> za<CR>

" File format
set fileformat=unix

" Show Invisible
set list
set showbreak=↪\
set listchars=trail:•,tab:❯-,precedes:◀,extends:▶,nbsp:␣
match ErrorMsg '\s\+$'

" Copy/Paste OSX
set clipboard=unnamed

" Vim dirs
set backupdir=~/.vim/backup//
set directory=~/.vim/swp//
set undodir=~/.vim/undo//

" Python settings
let python_highlight_all = 1
au! BufNewFile,BufReadPost *.{py} set filetype=python foldmethod=indent
autocmd FileType python setlocal ts=4 sts=4 sw=4 expandtab

" Yaml settings
au! BufNewFile,BufReadPost *.{yaml,yml} set filetype=yaml foldmethod=indent
autocmd FileType yaml setlocal ts=2 sts=2 sw=2 expandtab

" Need to install patched font:
" https://github.com/ryanoasis/nerd-fonts/tree/master/patched-fonts/SourceCodePro

" --------
" Plugins
" --------
call plug#begin('~/.vim/plugged')
  Plug 'patstockwell/vim-monokai-tasty'
  Plug 'dense-analysis/ale'
  Plug 'vim-airline/vim-airline'
  Plug 'vim-airline/vim-airline-themes'
  Plug 'preservim/nerdtree'
  Plug 'Xuyuanp/nerdtree-git-plugin'
  Plug 'tiagofumo/vim-nerdtree-syntax-highlight'
  Plug 'nvie/vim-flake8'
  Plug 'airblade/vim-gitgutter'
  Plug 'tpope/vim-fugitive'
  "Plug 'frazrepo/vim-rainbow'
  Plug 'mrk21/yaml-vim'
  Plug 'blueyed/vim-diminactive'
  Plug 'nathanaelkane/vim-indent-guides'
  Plug 'ryanoasis/vim-devicons'
call plug#end()

" Set theme
silent! colorscheme vim-monokai-tasty
if !has('gui_running')
  set t_Co=256
endif
set background=dark
hi Normal ctermbg=232
hi nonText ctermbg=232

" Airline config
let g:airline_powerline_fonts = 1
let g:airline#extensions#tabline#enabled = 1
let g:airline_theme='bubblegum'

" Vim rainbow settings
let g:rainbow_active = 1

" NERDTree settings
let NERDTreeQuitOnOpen=1
let NERDTreeShowHidden=1
let NERDTreeAutoDeleteBuffer = 1
let NERDTreeDirArrows = 1
let NERDTreeMinimalUI = 1
hi NERDTreeDir ctermfg=LightGray cterm=bold
nnoremap <silent> <expr> <C-o> g:NERDTree.IsOpen() ? "\:NERDTreeClose<CR>" : bufexists(expand('%')) ? "\:NERDTreeFind<CR>" : "\:NERDTree<CR>"
nnoremap <silent> <Leader>v :NERDTreeFind<CR>
"Start NERDTree when Vim is started without file arguments.
autocmd StdinReadPre * let s:std_in=1
autocmd VimEnter * if argc() == 0 && !exists('s:std_in') | NERDTree | endif
"Exit Vim if NERDTree is the only window remaining in the only tab.
autocmd BufEnter * if tabpagenr('$') == 1 && winnr('$') == 1 && exists('b:NERDTree') && b:NERDTree.isTabTree() | quit | endif
"Remove / at the end of dir names
augroup nerdtreehidecwd
  autocmd!
  autocmd FileType nerdtree syntax match NERDTreeDirSlash #/$# contained conceal containedin=NERDTreeDir
  autocmd FileType nerdtree setlocal conceallevel=3
augroup end

" Vim diminactive settings
hi ColorColumn ctermbg=234
let g:diminactive_enable_focus = 1
let g:diminactive_use_syntax = 1

" Vim Indent Guides
let g:indent_guides_exclude_filetypes = ['help', 'nerdtree']
let g:indent_guides_enable_on_vim_startup = 1
let g:indent_guides_start_level = 2
let g:indent_guides_guide_size = 1
let g:indent_guides_auto_colors = 0
hi IndentGuidesOdd ctermbg=236

" Highligh line in current window
set cursorline!
hi CursorLine ctermbg=234
